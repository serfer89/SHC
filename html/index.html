<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd\">
<html lang="en">
<head>
<meta charset="UTF-8">
<h1>Real Time</h1>
<script src="https://cdn.socket.io/socket.io-1.3.5.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<link rel="stylesheet" href="/css/styles.css">

<script>

 function GetCheckedState (elem) {
var id = elem.id;

document.getElementById (id).value = document.getElementById (id).checked


                if (elem.value == "true") {
                    socket.emit('publish', {topic:"outTopic",payload:"on"});
                    socket.emit('publish', {topic:"inTopic",payload:"1"});
                } else {
                    socket.emit('publish', {topic:"outTopic",payload:"off"});
                    socket.emit('publish', {topic:"inTopic",payload:"0"});
                }


        };

 
</script>
<script>
  var socket = io.connect('localhost:3000');
  socket.on('connect', function () {
    socket.on('mqtt', function (msg) {

      console.log(msg.topic+' '+msg.payload);
if (msg.payload == "on" || msg.payload == "off")
{

      if (msg.payload == "off") {
        if ($('#checked').is(':checked')) {
		$('#checked').prop('checked', false);
         
        }
      }
      if (msg.payload == "on") {
        if (!$('#checked').is(':checked')) {
		$('#checked').prop('checked', true);
        }
      }
	}
else {$('#mqt').text(msg.payload);}
    });
    socket.emit('subscribe',{topic:'outTopic'});
  });
</script>

</head>
 
<body>

<div id='mqt'></div>

<div class="row demo">
    <input id="checked" class="cbx hidden" checked="" type="checkbox" onchange="GetCheckedState (this)">
    <label for="checked" class="lbl"></label>
  </div>


</body>

    </html>
