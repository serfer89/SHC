<!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd\">
<html lang="en">
<head>
<meta charset="UTF-8">
<script src="https://cdn.socket.io/socket.io-1.3.5.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="/mqtt/js/charts.js"></script>
<link rel="stylesheet" href="/mqtt/css/styles.css">
<link rel="stylesheet" href="/mqtt/css/special_styles.css">

<script>

$( document ).ready(function() { 

if ($('.active').length  == 0)
{$('#device_div').addClass("hide");}
});
	function device_changer(elem, name) {

		var id = elem.id;
		$('.active').removeClass("active");
		$('#device_div').removeClass("hide");		
		document.getElementById(id).className += " active";
		
		$('#device_label').text(name);
		$('#device_id').val(id);
		socket.emit('subscribe',{topic:id});
		}


	function GetCheckedState (elem) {
		var id = elem.id;

			document.getElementById (id).value = document.getElementById (id).checked


	                if (elem.value == "true") {
	                    socket.emit('publish', {topic:$('#device_id').val(),payload:"1"});
	                    socket.emit('publish', {topic:"inTopic",payload:"1"});
	                } else {
	                    socket.emit('publish', {topic:$('#device_id').val(),payload:"0"});
	                    socket.emit('publish', {topic:"inTopic",payload:"0"});
	                }


			        };

 
</script>
<script>
  var socket = io.connect('localhost:3000');
  socket.on('connect', function () {
    socket.on('mqtt', function (msg) {

      console.log(msg.topic+' '+msg.payload);
if (msg.payload == "1" || msg.payload == "0")
{

      if (msg.payload == "0" && msg.topic == $('.active').attr('id')) {
        if ($('#device').is(':checked')) {
		$('#device').prop('checked', false);
         
        }
      }
      if (msg.payload == "1" && msg.topic == $('.active').attr('id')) {
        if (!$('#device').is(':checked')) {
		$('#device').prop('checked', true);
        }
      }
	}
else {$('#mqt').text(msg.payload);}
    });
    socket.emit('subscribe',{topic:'outTopic'});
  });
</script>

</head>
 
<body>






<div class="wrap">
	<!-- start grids_of_3 -->
	<!---728x90--->
	<div class="grids_of_3">
		<div class="grid1_of_3">
			<div class="btn_style bg0">
				<h4>Пристрої</h4>
			</div>
			<div class="grid_img">
				<img src="images/pic1.jpg" alt="">
						
			</div>
			<div class="menu_box_list">
				<ul id="device_list" >
	<li onclick="device_changer(this, 'Люстра')" id="light"><span class="nav_li">Люстра</span> <div class="clear"></div> </li>
	<li onclick="device_changer(this, 'Бра')" id="mini_light"><span class="nav_li">Бра</span> <div class="clear"></div> </li>
	<li onclick="device_changer(this, 'Підсвітка')" id="wall_light"><span class="nav_li">Підсвітка</span> <div class="clear"></div> </li>
	<li onclick="device_changer(this, 'Штора')" id="sunblind"><span class="nav_li">Штора</span> <div class="clear"></div> </li>
	<li onclick="device_changer(this, 'Ветилятор')" id="fan"><span class="nav_li">Ветилятор</span> <div class="clear"></div> </li>
	<li onclick="device_changer(this, 'Зволожувач')" id="moisturizer"><span class="nav_li">Зволожувач</span> <div class="clear"></div></li>

				</ul>
				<div class="clear"></div>
			</div>
		</div>
		<div class="grid1_of_3 left">
			<div class="btn_style bg">
				<h4>Пристрій</h4>
			</div>
			<div class="login_form" id="device_div">
				<div class="row demo">
					<input type="hidden" id=device_id value="">
					<label id="device_label" class="device_style"></label>
					<input name="device" id="device" class="cbx hidden" checked="" type="checkbox" onchange="GetCheckedState (this)">
					<label for="device" class="lbl"></label>


				</div>
			</div>
			<div class="soc_icons">
				<ul>
					<li><a class="icon_1" href="#"></a></li>
					<li><a class="icon_2" href="#"></a></li>
					<li><a class="icon_3" href="#"></a></li>
					<li><a class="icon_4" href="#"></a></li>
				</ul>	
			</div>
		</div>
		<div class="grid1_of_3 left">
			<div class="btn_style bg1">
				<h4>Web-cam</h4>
			</div>
			<div class="grid_img1">
				<img src="http://193.108.128.254:8081" alt="">
			</div>
				
			<div class="grids_left">
				
				<div class="clear"></div>
			
			</div>
		</div>
		<div class="clear"></div>
		<div class="grid1_of_3">
			<div class="btn_style bg2">
				<ul>
					<li>
						<p>День</p>
						<span>04</span>
					</li>
					<li>
						<p>Місяць</p>
						<span>Липень</span>
					</li>
				</ul>
			</div>
			<div class="chart">
			<canvas id="canvas" height="250" width="295" style="margin-top: 30px; width: 295px; height: 250px;"></canvas>
				<script>
						var lineChartData = {
						labels : ["January","February","March","April","May","June","July"],
						datasets : [
							{
								fillColor : "rgba(220,220,220,0.5)",
								strokeColor : "rgba(220,220,220,1)",
								pointColor : "rgba(220,220,220,1)",
								pointStrokeColor : "#fff",
								data : [65,59,90,81,56,55,40]
							},
							{
								fillColor : "rgba(151,187,205,0.5)",
								strokeColor : "rgba(151,187,205,1)",
								pointColor : "rgba(151,187,205,1)",
								pointStrokeColor : "#fff",
								data : [28,48,40,19,96,27,100]
							}
						]
						
					}
			
				var myLine = new Chart(document.getElementById("canvas").getContext("2d")).Line(lineChartData);
				
				</script>
			</div>
		</div>
		<div class="grid1_of_3 left">
			<div class="btn_style bg3">
				<h4>Температура</h4>
			</div>
			<div class="loader_main">
					<div class="outc c">
					  <small class="c a"></small>
					  <small class="c b"></small>
					  <small class="c d"></small>
					  <small class="c e"></small>
					  <div class="spinner">
					  <div class="spinner-inner"></div>
					  <div class="spinner-mask"></div>
					  <div class="spinner-mask-two"></div>
					</div>
					  <div class="innerc c"><img src="images/loader.png" alt="">  </div>
					</div>
				<div class="loader_top">
					<span id='mqt'>вимірюю...</span>
					
				<div class="clear"></div>
			</div>
			</div>
		</div>
		<div class="grid1_of_3 left">
			<div class="btn_style bg4">
				<h4>location</h4>
			</div>
			<div class="locate">
				<a href="#"><p class="new">san francisco</p></a> 
				<a href="#"><span class="mark"></span></a>
				<div class="clear"></div>
			</div>

		</div>
	<div class="clear"></div>
	<!---728x90--->

	<div class="copy">

	</div>
	</div>
	<!---728x90--->

</div>
</div>


</body>

    </html>
